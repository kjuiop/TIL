# 대용량 시스템에 대한 이해

---

![Screen Shot 2022-11-07 at 10 29 26 PM](https://user-images.githubusercontent.com/41246605/200324923-e4089aee-69c2-4dc0-8afc-8566f8d8980b.png)


<br />



### 웹 서버와 WAS 가 분리된 이유

---

- 관심사의 분리
- 관측가능한 시스템
- 효율적인 리소스 사용


# 스케일 업과 스케일 아웃

---

### 스케일 업 (scale up) 과 스케일 아웃 (scale out)

|  | 스케일 업 | 스케일 아웃 |
| --- | --- | --- |
| 유지보수 및 관리 | 쉬움 | 여러 노드에 적절히 부하분산 필요 |
| 확장성 | 제약성 있음 | 스케일어벵 비해 자유로움 |
| 장애복구 | 서버가 1대, 다운타임이 있음 | 장애 탄력성이 있음 |



![Screen Shot 2022-11-07 at 10 12 11 PM](https://user-images.githubusercontent.com/41246605/200325387-b5ad0697-3a3a-4d45-8b25-8c1955ef5db7.png)


### 스케일 아웃 적용 시 같은 입력에 대해서 항상 같은 결과를 반환해야 한다.


### 데이터베이스에서 스케일 아웃

- 데이터베이스는 데이터라는 상태를 관리하고 있어 서버보다 스케일 아웃을 하기 위해서는 훨씬 많은 비용이 필요
- 현대 서버 아키텍처는 상태관리를 데이터베이스에 위임하고, 서버는 상태관리를 하지 않는 방향으로 발전
- 스케일 아웃 외에도 데이터베이스는 디스크의 데이터를 접근해서 가져온다.

# 대용량 트래픽 / 데이터 처리의 어려운 점

---

- 하나의서버 또는 데이터베이스로 감당하기 힘든 부하
    - 다수의 서버와 데이터베이스를 마치 하나인 것처럼
- 웹 서비스들은 24시간 무중단
- 여러 마이크로 서비스들이 복잡한 의존 관계를 가진다.

### 대용량 트래픽 / 데이터 처리는 어떤 것을 지향해야 하는가

---

- 고가용성
    - 언제든 서비스를 이용할 수 있어야 한다.
- 확장성
    - 시스템이 비대해짐에 다라 증가하는 데이터와 트래픽에 대응할 수 있어야 한다.
- 관측 가능성
    - 문제가 생겼을 때 빠르게 인지할 수 있어야 하고 문제의 범위를 최소화 할 수 있어야 한다.

<br /><br />

## 점진적으로 대용량 시스템 아키텍처 발전시켜보기

---

![Screen Shot 2022-11-07 at 10 28 40 PM](https://user-images.githubusercontent.com/41246605/200325127-8d9d9e2d-6774-4963-9a6c-d2bcf507159c.png)


![Screen Shot 2022-11-07 at 10 28 47 PM](https://user-images.githubusercontent.com/41246605/200325138-473646b3-1034-4bd1-8630-75f8ac4f1466.png)


![Screen Shot 2022-11-07 at 10 28 55 PM](https://user-images.githubusercontent.com/41246605/200325145-4ff1f3f3-56aa-43b8-a7b8-2d87bd9b079f.png)

- 글로벌 캐시를 적용할지, 로컬 캐시를 적용할지 고민
    - 로컬 캐시 : 각 서버 메모리에 데이터를 캐싱하는 것
    - 글로벌 캐시 : Redis 와 같은 여러 서버들이 하나의 캐시를 공유하게 해주는 것
- 캐시 주기를 어떻게 설정할 것인가?
    - 만료 정책은 어떻게 할 것인가?
    
<br />

![Screen Shot 2022-11-07 at 10 29 06 PM](https://user-images.githubusercontent.com/41246605/200325154-c998a1ee-f3d0-4439-b373-827f1d7acd59.png)


![Screen Shot 2022-11-07 at 10 29 15 PM](https://user-images.githubusercontent.com/41246605/200325163-8a2688c8-d7dd-48a9-a5ad-db13ccbf3b92.png)

- 대외기간과 연동하는 부분에서 우리측 서버가 대외기간 서버의 응답을 계속해서 기다리는 문제가 발생할 수 있음
- Kafka 와 같은 메시지 큐를 통해 비동기 로직을 만들 수 있다.
- 하나의 서버 내에서 쓰레드 풀과 같은 비동기 큐를 만들 수 있다.
- 대외기간이 받을 수 있는 적정 요청량을 맞출 수 있다.

<br />

![Screen Shot 2022-11-07 at 10 29 26 PM](https://user-images.githubusercontent.com/41246605/200325175-fc502555-f37b-444a-9a1a-fa4bfe187678.png)

