### WebRTC란

- WebRTC 는 P2P (Peer-to-Peer) 통신 기술을 사용하여 브라우저 간에 오디오와 비디오를 전송하며, 이를 위해 특정 프로토콜 (WebRTC MediaStream) 을 사용합니다.
- WebRTC 는 실시간 오디오와 비디오 통신 기능을 제공하므로, 브라우저 간 실시간 화상 통화, 온라인 미팅, 실시간 스트리밍 등의 사용 사례에 적합합니다.

### CMAF 란

- CMAF (Common Media Application Format) 는 동영상 콘텐츠를 전송하기 위한 표준 포맷입니다.
- CMAF 는 HTTP 기반의 스트리밍 프로토콜 (HLS, DASH) 을 사용하여 동영상 컨텐츠를 전송하며, 이를 위해 특정 포맷 (fMP4, CMAF chunk 등 ) 을 사용합니다.
- CMAF 는 동영상 스트리밍을 위한 표준 포맷으로, 동영상 컨텐츠를 전송할 때 사용됩니다.
- HTTP 기반 스트리밍 프로토콜 (e.g. HLS, DASH) 을 사용하며, 다양한 디바이스에서 스트리밍 컨텐츠를 재생할 수 있습니다.
- 사용 사례로는 OTT, 실시간 스트리밍, VOD 등이 있습니다.

<aside>
💡 WebRTC 는 실시간 오디오와 비디오 통신에 적합하고, CMAF 는 동영상 스트리밍에 적합한 기술이다.

</aside>

### CMAF 및 WebRTC 의 이점

- 대기시간은 양방향 참여가 필요한 스트리밍 시나리오를 뒷받침합니다.
- 스트림을 제공하는데 사용하는 기술에 따라 비디오 지연이 최대 45초까지 증가할 수 있습니다.
- CMAF , WebRTC 모두 이러한 대기시간을 줄이기 위해 사용되는 기술입니다.

![1a](https://user-images.githubusercontent.com/41246605/214576828-4e0258bf-13d3-4ba3-9026-ecbd3ddd29c0.png)

## CMAF 란

- CMAF (Common Media Application Format) 는 HTTP 기반 스트리밍 미디어의 전달을 단순화하기 위한 스트리밍 형식입니다.
- CMAF 는 프로토콜이 아니라 DASH 와 HLS 모두에서 참조할 수 있는 형식입니다.

- CMAF 이전에는 Apple 및 Microsoft 장치 모두에서 사용자에게 접근하려는 모든 컨텐츠 배포자가 동일한 데이터를 두 번 인코딩하고 저장해야 했습니다.
    - .ts 형식이 Apple 장치에 컨텐츠를 전달하는데 사용된 반면
    - Micorosft 장치는 ISOBMFF 를 기반으로 하는 .mp4 컨테이너를 허용했기 때문입니다.
    - 이로 인해 iPhone, 스마트 TV, Xbox 및 PC를 통해 시청자에게 도달하는 비용이 많이 들고, 비효율적이었습니다.
- CMAF 는 표준화된 운송 컨테이너 역할을 하여 프로세스를 간소화하였습니다.

![2a](https://user-images.githubusercontent.com/41246605/214576852-2c3c56e7-9a6a-4975-bef7-a9e6fdacffbc.png)

### 저지연 CMAF 란?

- Low Latency 를 지원하려면 CMAF 스트림이 두 가지 핵심 기술과 함께 제공되어야 합니다.
    - 청크 인코딩
    - 청크 전송 인코딩
- 이 프로세스에서는 비디오를 설정된 지속 시간의 더 작은 청크로 분할한 다음 인코딩 시 즉시 게시할 수 있습니다.
- 이후 청크가 계속 처리되는 동안 계속해서 청크를 전송할 수 있습니다.
- 올바르게 수행되면, 청크 인코딩 및 청크 전송 CMAF 는 규모에 관계없이 3초 미만의 대기 시간을 가능하게 합니다.

### 지연시간이 짧은 CMAF 작동방식

- 기존의 HTTP 기반 스트리밍 워크플로에서 인코더는 CDN 으로 전송하기 전에 전체 세그먼트를 생성하기를 기다립니다.
- 대기 시간이 짧은 CMAF 를 사용하면 세그먼트 자체가 여전히 인코딩되는 동안 세그먼트를 구성하는 개별 청크가 전달을 위해 푸시됩니다.
- HLS 또는 DASH 스트림의 세그먼트 크기를 줄이는 것은 지연을 최소화 하는 한가지 방법인데 반해, CMAF 는 대기시간을 세그먼트 크기에서 완전히 분리합니다.

![3a](https://user-images.githubusercontent.com/41246605/214576867-48a49a7d-21c0-4deb-850d-c9b711f53f7c.png)

- 위의 그래프 중 하단 그래프를 보면 `mdat` 와 `moof` 가 포함되어 있는 것을 알 수 있다.
    - mdat : 영상정보 ?
    - moof : 영상 ?
- 각 청크 내에서 완전히 페어링 (mdat + moof) 를 포함하게 함으로써 플레이어가 전체 세그먼트를 기다리지 않고, 청크 단위로 플레이를 할 수 있는 것

## WebRTC 란

---

- WebRTC 는 실시간 통신을 가능하게 하는 표준, 프로토콜 및 JavaScript API 의 조합입니다.
- Chrome, Filefox 또는 Safari 를 통해 연결하는 사용자는 브라우저를 통해 직접 통신할 수 있으므로, 대기시간이 500ms 미만입니다.

### WebRTC 작동 방식

---

- WebRTC 프레임워크는 플러그인 없어도 브라우저 간 P2P 연결을 활용하여 거의 동시에 통신을 교환합니다.
- Chrome, Firefox 및 Safari 에 내장된 세 가지 HTML5 API 를 사용하여 직접 브라우저 기반 통신을 허용합니다.

![4a](https://user-images.githubusercontent.com/41246605/214576875-4956c79b-0d56-47b4-9b0f-1be9624ef6f0.png)


### 지연 시간이 짧은 CMAF 와 WebRTC 비교 : 전달속도

- WebRTC 는 대기 시간 경쟁에서 1위를 차지했습니다.
- 한 브라우저에서 다른 브라우저로 비디오 및 오디오 데이터를 가져오는데 500 밀리초도 걸리지 않아 WebRTC 가 실시간 통신을 가능하게 합니다.
- CMAF 는 3초 미만의 전송 속도로 제공되지만 청크 인코딩 및 청크 전송 인코딩과 함께 배포된 경우에만 해당합니다.

### 지연 시간이 짧은 CMAF 와 WebRTC 비교 : 확장성

- CMAF
    - 지연 시간이 짧은 CMAF 는 확장성이 우려되는 모든 시간에 가장 적합한 경로입니다.
    - 이 형식은 HLS 또는 DASH 프로토콜을 지원하는 모든 장치에 대해 단일 인코딩 전달에 최적화 되어 있습니다. 이를 통해 서버 효율성을 간소화하고 광범위한 청중에게 다가갈 수 있습니다.
- WebRTC
    - WebRTC 는 확장성을 염두에 두고 설계되지 않았습니다.
    - 대역폭을 많이 사용하는 이 옵션을 사용하려면, 참여하는 각 브라우저가 피어 연결을 통해 서로 연결해야 합니다.
        - WebRTC 전문가인 TsahiLevent-Levi 는 50개 이상의 동시 피어 연결을 피할 것을 권장
    - 확장성을 해결하기 위해 미디어 서버 소프트웨어를 사용하여 WebRTC 스트림을 트랜스코딩할 수 있지만 그 과정에서 대기 시간이 발생합니다.

### 지연 시간이 짧은 CMAF vs WebRTC 브로드캐스트 품질

- CMAF
    - 대기시간이 짧은 4K 및 높은 프레임 속도 스트리밍과 같은 HD 기능을 지원합니다.
    - 대기시간이 짧은 CMAF 는 4K 및 높은 프레임속도 스트리밍과 같은 HD 기능을 지원합니다.
        - 이러한 기능은 인코딩 시간을 늘릴 수 있지만 CMAF 는 여전히 지연시간이 짧은 고품질 방송을 위한 최상의 옵션 입니다.
- WebRTC
    - WebRTC 는 화상 회의 및 유사한 사용 사례를 위해 설계되었기 때문에 품질이 주요 목표가 아니었습니다.
    - WebRTC 는 실시간 전달을 가능하게 하기 위해 품질에 영향을 미칠 수 있는 GOP 구조에서 B-프레임을 희생합니다.
    - WebRTC 관련하여 대역폭 문제가 최우선이므로 프레임 속도를 제한하는 것도 좋은 생각입니다.

### 지연 시간이 짧은 CMAF 와 WebRTC 사용사례

| 지연 시간이 짧은 CMAF | WebRTC |
| --- | --- |
| 일대다 대화형 스트리밍 라이브 | 일대 다 대화형 스트리밍 소규모 그룹을 위한 화상회의 |

### WebRTC vs CMAF

- CMAF 는 지연시간이 짧은 스트리밍 블록입니다.
- WebRTC 와 마찬가지로 비디오 캡처와 재생 사이의 지연시간을 줄이는 것을 목표로 합니다.