### 1만건의 쿼리문을 100건으로 바꾸는 redis 의 쓰기 지연 전략

### 주제

- redis 의 쓰기 지연 전략 적용

### 내용

- 조회수 라는 항목을 어떻게 관리해야 할까요?
- 조회수를 게시글의 필드로 설정해서 관리
- 게시물은 RDB 에 저장하고 사용되기 때문에 조회수가 증가하면 게시글의 조회수를 update를 해주어야 했음
- 조회수는 사용자가 게시글을 조회할 때마다 올라가는 값이기에 Update 되는 빈도가 굉장히 많았다.
- 만약 하루에 조회수가 1만건이라면, 서버는 1만건의 update 쿼리를 처리해야 한다. 이는 성능상 비효율적이다.
- 이 문제를 해결하기 위해 Redis 를 사용했다.
- 조회수를 증가시킬 때, 조회수를 조회, 증가, 반영하는 작업을 기본적으로 Redis에서 처리하게 합니다. 만약 Redis 에서 조회수를 조회할 때, 값이 없다면 RDS에 있는 값을 조회합니다.
- 이후에는 일정 주기마다 Redis 의 조회수를 DB에 반영시킵니다.


![1a](https://user-images.githubusercontent.com/41246605/212040727-590bd73b-5117-4961-bc00-b9fa0b242f34.png)

- Redis 는 인메모리 방식의 저장소이기 때문에 RDB 에 비해 굉장히 빠른 성능을 갖고 있습니다.
- 때문에 조회수가 변경될 때마다 Redis 를 사용하는 위 방식은 매번 Update 쿼리를 날려야하는 RDB를 사용하는 것에 비해 성능이 크게 개선되게 됩니다.
- 실제로 redis 를 적용한 전후 성능테스트를 해보면 게시물 조회의 경우, 기존에 비해 TPS (초당 처리건수) 가 5배 정도 증가한 것을 알 수 있습니다.

![2a](https://user-images.githubusercontent.com/41246605/212040751-df6cc0b7-a503-4469-9206-4e4c1e49212e.png)


- 또한 Redis 의 조회수는 일정 주기, 서비스 실행 시마다 RDB에 저장이 되기 때문에 조회수의 지속적인 보관도 문제되지 않습니다.
- 만약 하루에 한번 Redis 에서 RDS 로 조회수를 업데이트한다면, 하루 100건의 게시물에 대해 1만건의 조회가 이루어지는 서비스에서는 100건의 update 쿼리만 처리하면 됩니다.
- 이처럼 변경이 잦은 항목을 redis 에서 관리하게 하는 것으로 성능을 효과적으로 개선할 수 있었습니다.

# Reference

---

- [https://velog.io/@eastperson/레디스-알아보기](https://velog.io/@eastperson/%EB%A0%88%EB%94%94%EC%8A%A4-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0)

