
# 하스켈로 백엔드 시스템 만든 이야기

---

### 컨스택츠 - 김은민

### 왜 하스켈인가?

---

- Closure
    - 타입 시스템에 대한 아쉬움

<br />

### Dev Environment

- VS Code
- Github Actions
- GHCup
- Google Cloud Platform
- Kubernetes

<br />

### Architecture

- 도메인 정의
    - 애그리거트를 요구 사항에 맞게 변경
    - 엔티티의 상태 변경을 하는 ( Mutation ) 이 일어나는 애들을 도메인으로 정의하여 모아놨다.
    - 도메인과 관련된 애들은 커스텀 타입을 만들어서 응집도를 높임
    - 커스텀 타입을 생성하여 Validation 기능을 넣어줬다.
    - Class Type
        - 인터페이스와 같은 역할
        - EX ) answer : Question 이란 도메인을 상태변경해주는 타입이다.

- 서비스 정의
    - 서비스를 도메인 영역에 취급한다.

- 도메인 외적인 코드는 InfraStructure 처럼 외부에 위치시켰다.
    - GraphQL Resolver
    - DB …

- 런타임이 아닌, 컴파일 타입에서 구현체 주입이 이루어진다.

- 엔티티가 변경된 부분들은 모두 Kafka 로 발행하여 이벤트를 처리한다.

- 하나의 커다란 도메인 타입을 생성하고, 하위 이벤트를 선언하여 재사용이 가능하도록 구성하였다.

- DB : Postgresql → 컴파일 단계에서 필드 Validation 을 잡아준다.

- 엔티티 조회는 모두 View.js 에서 해결하였다.
    - 엔티티의 형태를 강제하는 것이 아님
    - 뷰에 맞게 테이블을 구성해서 DB 를 분리할 예정

- App 은 조회와 쿼리를 물리적으로 분리된 서버에 요청한다.

- 유닛 테스트
    - 도메인
    - 서비스 : 테스트하고자 하는 구현체를 주입하여 테스트 진행

- 통합테스트
    - api 서버에 대한 end-point test 를 진행
    - test Database 사용

- 배포
    - GitHub Action
    - Docker
    - K8s
    - GCP

<br />

### 하스켈을 쓰면서 아쉬웠던 점?

- 빌드 속도가 오래걸린다.  ( 10분 )
- VS Code 에서 사용하는 Code 리팩토링 기능을 사용하지 못해 아쉽다.
- id 와 같은 제네릭한 필드명도 모두 충돌나기 때문에 레코드의 네이밍이 아쉬웠다.

<br />

### 하스켈을 쓰면서 좋았던 점

- 컴파일 단에서 바로 에러를 잡아낼 수 있었기 때문에 테스트나 Curl 을 할 필요가 없다.
- 타입이 강력하다보니 리팩토링도 손쉽게 진행할 수 있다.


