# 채팅 아키텍처 설계 시 고려 사항

---

### 채팅 앱의 종류에 대해 파악

- 1:1 또는 그룹 기반의 채팅
- 앱의 규모 (일일 활성 사용자(DAU) 5,000만명 지원)
- 그룹 채팅의 경우 그룹 구성원 한도 (최대 100명)
- 채팅 앱에서의 중요한 기능
    - 1:1 채팅
    - 그룹 채팅
    - 온라인 인디케이터
- 메시지 크기 제한
    - 텍스트 길이는 100,000 자 미만
- 종단 간 암호화 필요 여부
- 채팅 기록을 얼마나 오래 저장
    - 영원히

### 채팅 앱 기능

- 지연 시간이 짧은 일대일 채팅
- 소그룹 채팅(최대 100명)
- 온라인 존재
- 여러 장치 지원, 동일한 계정으로 동시에 여러 계정에 로그인 가능
- 푸시 알림



# 높은 수준의 디자인 제안 및 승인 받기

- 다른 클라이언트로부터 메시지를 받습니다.
- 각 메시지에 적합한 수신자를 찾아 메시지를 수신자에게 전달하십시오.
- 받는 사람이 온라인 상태가 아닌 경우 온라인 상태가 될 때까지 해당 받는 사람의 메시지를 서버에 보관합니다.

![1b](https://user-images.githubusercontent.com/41246605/213138739-6fdba932-cbed-4d24-9c41-8ab498011b2b.png)



- 클라이언트가 채팅을 시작하려고 하면, 하나 이상의 네트워크 프로토콜을 사용하여 채팅 서비스에 연결합니다.
- 채팅 서비스의 경우 네트워크 프로토콜의 선택이 중요합니다.

### 고려사항

- 발신자
  - 대부분의 클라이언트/서버 응용 프로그램에 대한 요청은 클라이언트에서 시작됩니다.
  - 이는 채팅 애플리케이션의 발신자 측에서도 마찬가지입니다.
  - 그림 2에서 보낸 사람이 채팅 서비스를 통해 받는 사람에게 메시지를 보낼 때 가장 일반적인 웹 프로토콜인 HTTP 프로토콜을 사용합니다.
  - 이 시나리오에서 클라이언트는 채팅 서비스와의 HTTP 연결을 열고 메시지를 보내 수신자에게 메시지를 보내도록 서비스에 알립니다.
  - 연결 유지 헤더는 클라이언트가 채팅 서비스와의 지속적인 연결을 유지할 수 있도록 하므로, 연결 유지가 효율적입니다.
  - 또한 TCP 핸드셰이크 수를 줄입니다.
  - HTTP 는 발신자 측에서 훌룡한 옵션이며, Facebook[1] 과 같은 많은 인기 있는 채팅 응용 프로그램은 처음에 HTTP를 사용하여 메시지를 보냈습니다.

- 수신자
  - HTTP는 클라이언트에서 시작하므로 서버에서 메시지를 보내는 것이수비지 않습니다.
  - 수년에 걸쳐 폴링, 긴 폴링 및 WebSocket 과 같은 많은 기술이 서버 시작 연결을 시뮬레이트하는 데 사용되었습니다.


