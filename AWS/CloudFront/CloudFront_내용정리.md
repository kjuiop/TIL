## CloudFront 란

- CloudFront 는 S3 버킷에서 정적 웹사이트를 콘텐츠를 호스팅할 때 가용성을 높이기 위한 솔루션이다.
- 다른 리전을 가리키는 추가 CloudFront 오리진을 생성할 수 있다.
    - us-east-1 을 기본으로 ap-southeast-1 버킷을 보조로 사용하여 CloudFront 오리진 그룹을 설정할 수 있다.
- 단일 AWS 리전에 애플리케이션 스택 배포를 CloudFront 를 이용하고, ALB를 오리진으로 지정하여 모든 정적 및 동적 컨텐츠를 제공한다.
- CloudFront 는 전세계의 사용자에게 지연시간을 가장 최소화하는 솔루션이다.
- CloudFront 를 통해 정적, 동적 콘텐츠를 모두 배포하는 것이 보다 적합하다.
- CloudFront 는 네트워크 엔드포인트에서 애플리케이션 데이터의 캐싱 버전을 제공해 사용자의 요청에 신속하게 반응하도록 한다.
- Amazon CloudFront 를 사용하여 콘텐츠 전송 네트워크(CDN) 생성 정적 및 동적 컨텐츠에 대한 캐싱 활성화 및 높은 만료 기간을 지정할 수 있다.
- CloudFront 에 lambda@Edge 는 엣지로케이션에서 Lambda 컴퓨팅을 수행하는 기능으로 EC2의 고가용성을 위한 솔루션이 아니다.
- 정적 자산을 CloudFront 로 이동할 수 없음, 배포 솔루션이지 스토리지 솔루션이 아님. S3로 이동해야 함
- 콘텐츠 전송 네트워크 서비스 (CDN, Contests Delivery Network)
- 엣지 로케이션의 콘텐츠 캐싱을 이용해 콘텐츠를 사용자에게 더 빨리 배포하도록 지원하는 서비스
- 전세계에 배포된 200개 이상의 엣지 로케이션을 이용하여 콘텐츠 전송
- 엣지 로케이션은 데이터를 임시 저장할 수 있는 캐싱 기능이 있음
- 엣지 로케이션에서 콘텐츠를 캐싱하는 기간은 기본 24시간이며 변경할 수 있다.
- CloudFront 의 가장 짧은 만료 기간은 0초이다. (이는 캐싱하지 않는다는 의미)

<br />

## CloudFront 특징

- 계약이나 약정 없이도 컨텐츠를 글로벌 네트워크에 배포할 수 있다.
- 짧은 지연시간과 높은 데이터 전송 속도로 콘텐츠를 배포한다.
- 사용자 요청이 컴퓨팅 리소스  또는 스토리지 용량을 넘을 시 성능 향상이 안될 수 있다.
- 엣지 로케이션에서 파일을 삭제하는 방법은 원본서버에서 파일 제거 후 CloudFront 의 배포 만료 시간을 0으로 한다.
- 엣지 로케이션에서 객체를 즉시 삭제하는 방법은 무효화 API를 사용한 객체 삭제이다. 비용이 부과된다.

- 사용자에게 가까운 곳의 엣지로케이션에서 데이터를 전송
- 글로벌 배포
- 전세계 사용자에게 최상의 경험을 제공
- 콘텐츠 지연시간을 최소화 하면서 제공
- 비디오 콘텐츠 등의 실시간 스트리밍 배포
- 웹사이트 속도를 높여 해외사용자에게 향상된 브라우징 경험
- EC2 등의 오리진 서버의 부하를 줄일 수 있음
- 오리진에서 CloudFront 로 전송되는 비용은 부과되지 않으므로 비용 절감 효과가 있음
- 사용자의 요청 헤더값에 따라 서로 다른 버전의 콘텐츠를 캐싱하여 제공할 수 있음


<br />

## Price Classes

- 전체 가격 등급 : 모든 리전에 배포
- 가격 등급 200 : 대부분의 리전에 배포
- 가격등급 100 : 일부 리전에 배포하며 가장 낮은 비용

<br />

### CloudFront Origin Group

- CloudFront 에 대한 고가용성
- 오리진 장애 조치를 사용하여 CloudFront 를 설정
- 기본 오리진과 보조 오리진이 포함된 오리진 그룹을 생성
- 기본 오리진을 사용할 수 없거나 실패를 나타내는 특정 HTTP 응답 상태 코드를 반환하는 경우 CloudFront는 자동으로 보조 오리진으로 전환

<br />

### Lambda@Edge

- CloudFront를 통해 전달되는 콘텐츠를 사용자 지정하는 함수를 실행할 수 있게 해주는 AWS Lambda가 확장된 컴퓨팅 서비스
- Node.js 또는 Python 함수를 작성한 후 사용자와 가까운 엣지 로케이션에서 해당 함수를 실행
- 다음과 같은 CloudFront 이벤트가 발생할 때 Lambda 함수를 실행
  - CloudFront 가 최종 사용자의 요청을 수신할 때 (최종 사용자 요청)
  - CloudFront 가 오리진에 요청을 전달하기 전 (오리진 요청)
  - CloudFront 가 오리진의 응답을 수신할 때 (오리진 응답)
  - CloudFront 가 최종 사용자에게 응답을 반환하기 전 (최종 사용자 응답)
- Lambda@Edge 사용 예
  - A/B 테스트를 위해 사이트의 다양한 버전을 볼 수 있도록 쿠키를 검사하고 URL을 다시 작성
  - User-Agent 헤더를 확인하여 사용 중인 디바이스를 기반으로 디바이스의 화면 크기에 따라 다른 이미지를 반환
  - 최종 사용자 요청 또는 오리진 요청 이벤트가 발생할 때 HTTP 응답을 생성
  - 데이터 전송 비용을 줄이기 위해 사용자에게 전송되는 파일을 압축

