# 주키퍼란?

---

- 주키퍼는 안정적인 코디네이션 서비스를 목표로 설계되었다.
- 주키퍼는 파일 시스템 API 와 유사한 단순 API 를 제공한다.
    - 마스터 서버 선출
    - 그룹 멤버십 관리
    - 메타 데이터 관리
- 주키퍼는 자바, C, Go API 로 구현되어 있는 애플리케이션 라이브러리이다.
- 전용 서버로 구성된 앙상블 (여러 대의 서버) 에서 동작하는 컴포넌트라고 할 수 있다.
- 주키퍼는 앙상블로 구성되기 때문에 장애처리와 대규모 처리를 가능하게 한다.
- 주키퍼를 사용하여 애플리케이션을 설계할 때 주의점
    - 컨트롤이나 코디네이션 데이터와 애플리케이션 데이터를 구별하는 것이 좋다.
    - 웹 메일 서비스 이용자는 자신의 메일 박스 내용에는 관심이 있지만, 특정 메일 박스에 대한 요청을 어떤 서버가 처리하는지 관심이 없다.
        - 사용자의 메일 박스 내용은 애플리케이션 데이터
        - 메일 박스에 대한 요청을 특정 메일 서버와 관련 짓는 것을 코디네이션 데이터 (혹은 메타 데이터) 라고 할 수 있다. (주키퍼의 관리 대상)

### 주키퍼의 역할

- 주키퍼는 분산 시스템의 코디네이션 작업을 가능하게 한다.
- 코디네이션 작업은 프로세스들 간의 협력이나 경합을 조절하는 것
    - 협력 : 프로세스들이 작업을 함께 수행해야 하고 다른 프로세스가 진행될 수 있도록 어떤 일을 해야 하는 것
        - 전형적인 마스터 워커 구조에서 워커는 자신이 일을 할 수 있는 상태임을 마스터에게 알리고, 이에 마스터는 작업을 워커에게 할당한다.
    - 경합 : 두 프로세스가 동시에 진행할 수 없는 상황을 의미한다.
        - 그래서 한 프로세스는 다른 프로세스가 끝날 때까지 기다려야 한다.
            - 워커가 단 하나의 마스터만 갖기 운할 경우 프로세스들은 서로 마스터가 되는 것을 시도
            - 여러 프로세스들의 경합 상황에서는 상호배제 (mutual exclusion) 구현이 필요하다.
        - 실제로 락을 획득하는 것 중 하나로 마스터십을 획득하는 일이 예시가 될 수 있다.

- 동기화 기본 요소를 구현하는 메시지 패싱 알고리즘에는 여러 방법이 있지만, 주키퍼처럼 순차적으로 처리해주는 공유 저장소 같은 컴포넌트를 이용하는 것이 더 쉽다.
- 코디네이션은 리더 선출, 락 같은 동기화 기본요소의 형태만을 가지는 것이 아니다.
- 코디네이션에서 설정, 메타데이터는 프로세스 상호 간에 진행 상황을 전달하는 방법으로 이용된다.
- 마스터 워커 시스템의 예에서 워커는 자신에게 할당된 작업을 알아야 하고, 이 정보는 마스터가 장애인 상황에서도 알 수 있어야 한다.



### 주키퍼가 유용하게 사용된 예시

- 아파치 HBase
    - HBase 는 대표적으로 하둡을 이용하는 데이터 저장소이다.
    - HBase 에서는 클러스터 마스터 선출과 가용 서버들의 목록을 저장하고, 클러스터의 메타데이터를 관리하는데 주키퍼를 사용한다.
- 아파치 카프카
    - 카프카는 발행 구독 기반의 메시징 시스템이다.
    - 카프카는 장애 감지, 토픽 디스커버리, 토픽에 대한 생성과 소비 상태를 관리하는데 주키퍼를 이용한다.